---
import Layout from "../layouts/Layout.astro";
import config from "../config";

let err;

if (Astro.request.method === "POST") {
  const data = await Astro.request.formData();
  const name = data.get("nom");
  const password = data.get("password");
  console.log("la abuela fuma");

  const options = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({name, password}),
  };
  let resposta = await fetch(`${config.API_URL}/login`, options);
  resposta = await resposta.json();

  if (resposta.error) {
    err = resposta.error;
    return Astro.redirect("/login_error");
  } else {
    const cookieOptions = {httpOnly: false, maxAge: 7200000};
    Astro.cookies.set("token", resposta, cookieOptions);
    return Astro.redirect("/");
  }
}
---

<Layout title="Inicio de sesion">
  <div
    class="w-1/2 flex flex-col mx-auto mt-8 content-center border mb-8 p-8 bg-white rounded-md shadow-md shadow-white-500"
  >
    <form method="POST" class="w-1/2 m-auto">
      <div class="md:flex md:items-start mb-6">
        <div class="md:w-1/3">
          <label
            class="block text-gray-500 md:text-right mb-1 md:mb-0 pr-4"
            for="inline-full-name"
          >
            Nom
          </label>
        </div>
        <div class="md:w-2/3">
          <input
            class="shadow-md shadow-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700"
            name="nom"
            type="text"
          />
        </div>
      </div>

      <div class="md:flex md:items-center mb-6">
        <div class="md:w-1/3">
          <label
            class="block text-gray-500 md:text-right mb-1 md:mb-0 pr-4"
            for="inline-full-name"
          >
            Password
          </label>
        </div>
        <div class="md:w-2/3">
          <input
            class="shadow-md shadow-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700"
            name="password"
            type="text"
          />
        </div>
      </div>

      <button
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
      >
        Login
      </button>
    </form>
  </div>
</Layout>
